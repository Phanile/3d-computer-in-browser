<!DOCTYPE html> 
<html>
    <head> 
        <meta charset="utf-8">
        <title>3D PC</title>
        <link rel="stylesheet" href="styles/style.css">
    </head> 
    <body>
        <canvas id="canvas"></canvas>
        <script src="scripts/data.js"></script>
        <script src="node_modules/three/build/three.js"></script> 
        <script type="module">
            import { OBJLoader } from '/node_modules/three/examples/jsm/loaders/OBJLoader.js'
            import { MTLLoader } from '/node_modules/three/examples/jsm/loaders/MTLLoader.js'
            import { OrbitControls } from '/node_modules/three/examples/jsm/controls/OrbitControls.js'
            import { GUI } from '/node_modules/three/examples/jsm/libs/dat.gui.module.js'

            let computerVectors = []
            let currentVectorIndex = 0

            const scene = new THREE.Scene()
            const canvas = document.querySelector('#canvas')
            const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000)
            camera.position.set(-45, -65, 465)
            const renderer = new THREE.WebGLRenderer({canvas})
            const objLoader = new OBJLoader()

            const dirLight = new THREE.DirectionalLight(0xffffff)
            dirLight.position.set(0, 200, 100)
            scene.add(dirLight)
            

            renderer.setSize(window.innerWidth, window.innerHeight)
            document.body.appendChild(renderer.domElement)

            const groundMesh = new THREE.Mesh(new THREE.PlaneGeometry(2000, 2000), new THREE.MeshPhongMaterial({color: 0x999999, depthWrite: false}));
			scene.add(groundMesh)
            renderer.render(scene, camera)
            
            const loadComputer = (computerId) => {
                computers.forEach(comp => {
                    if (comp.id == computerId) {
                        var computer = comp
                        objLoader.load(computer.pathToModel,
                            function(object) {
                                onComputerLoaded(object)
                            },
                            function (xhr) {
                                console.log((xhr.loaded / xhr.total * 100 ) + '% loaded')
                            },
                            function (error) {
                                console.log('An error happened')
                            }
                        )
                    }
                });
            }

            const loadAllComputers = () => {
                for (var computer of computers) {
                    if (computer.load) {
                        var xPos = 0
                        objLoader.load(computer.pathToModel,
                            function(object) {
                                onComputerLoaded(object)
                                object.position.x = xPos
                                xPos += 500
                            },
                            function (xhr) {
                                console.log((xhr.loaded / xhr.total * 100 ) + '% loaded')
                            },
                            function (error) {
                                console.log('An error happened')
                            }
                        )
                    }
                }
            }

            const onComputerLoaded = (comp) => {
                scene.add(comp)
                renderer.render(scene, camera)
                computerVectors.push(comp.position)
                console.log('computer added', comp.name)
                console.log(computerVectors)
            }

            function moveCameraToNextComputer() {
                if (camera.position.x + 45 <= computerVectors[currentVectorIndex].x) {
                    camera.position.x += 5
                    requestAnimationFrame(moveCameraToNextComputer)
                }
                renderer.render(scene, camera)
            }
            
            function moveCameraToPreviousComputer() {
                if (camera.position.x + 45 >= computerVectors[currentVectorIndex].x) {
                    camera.position.x -= 5
                    requestAnimationFrame(moveCameraToPreviousComputer)
                }
                renderer.render(scene, camera)
            }
            
            function onNextButtonClick() {
                if (currentVectorIndex + 1 > computerVectors.length) {
                    return
                }
                currentVectorIndex++
                moveCameraToNextComputer()
            }
            
            function onPreviousButtonClick() {
                if (currentVectorIndex - 1 < 0) {
                    return
                }
                currentVectorIndex--
                moveCameraToPreviousComputer()
            }

            loadAllComputers()

            switcher_right.onclick = onNextButtonClick
            switcher_left.onclick = onPreviousButtonClick

            const gui = new GUI()
            const cam = gui.addFolder('Camera')
            cam.add(camera.position, 'x', -1000, 1000).listen().onChange(function(value){camera.position.x = value; renderer.render(scene, camera)})
            cam.add(camera.position, 'y', -1000, 1000).listen().onChange(function(value){camera.position.y = value; renderer.render(scene, camera)})
            cam.add(camera.position, 'z', -1000, 1000).listen().onChange(function(value){camera.position.z = value; renderer.render(scene, camera)})
        </script>
    <button id="switcher_left">previous</button>
    <button id="switcher_right">next</button>
    </body> 
</html>
